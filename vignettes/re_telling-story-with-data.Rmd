---
title: 'RE: Telling a story from data'
output: html_document
editor_options: 
  chunk_output_type: console
---

# Setup and first thoughts
At first, let's load the necessary libraries and take a look at the data. From the documentation we see that it is about New York air quality measurements from May to September 1973 (measured daily).
The different variables were *measured at different places*, for example `Ozone` at Roosevelt Island, `Solar.R` at Central Park.
For us, it is not so convenient to work with 'mph' and 'degrees F', so we convert it to 'kmph' and 'degrees C'. For this conversion we use the package `{weathermetrics}`.


```{r message=FALSE}
library(weathermetrics)
library(tidyverse)
airquality |> str()
airquality |> summary()
airquality |> head()
```

We immediately see some other problems: At least two columns contain `NA` values and we don't have a very large data set (153 observations).
Let us take a further look at the missing values using the `visdat::vis_miss()` function.

```{r}
visdat::vis_miss(
  airquality,
  cluster = FALSE, 
  warn_large_data = FALSE
  )
```

Unfortunately, 24% of the rows have no `Ozone` value and 5% have no `Solar.R` value.
We also see that most of the missing values are between row 25 and row 70.
This decreases robustness of the analysis, especially for the months of June and early July.

We convert the units and set the `Month`, `Day` as factors. Note that this unit conversion creates some floating point imprecision.

```{r}
airquality <- airquality |> 
  mutate(
    Date = lubridate::ymd(paste(1973, Month, Day, sep = "-")),
    across(c(Month, Day), as.factor),
    Wind_kmh = weathermetrics::convert_wind_speed(Wind, "mph", "kmph"),
    Temp_C = weathermetrics::convert_temperature(Temp, "f", "c"))
str(airquality)
```

# Telling a story

## Hypotheses
- The higher the temperature and solar radiation, the higher the Ozone concentration.
- The higher the Wind speed, the lower the Ozone concentration.
Why? 
A higher temperature is caused by the incoming sunlight, thus a higher temperature should increase the ozone concentration.
For the same reason an increase in solar radiation should lead to an increase in ozone concentration.

In contrast more wind should lead to a decrease in ozone concentration because generally in a city we expect a higher ozone concentration than in more green area / ocean. So with more wind, more ozone will be outgoing than incoming.

## Testing hypothesis
We are now interested in showing the relation between `Ozone` and the other covariates.
We plot the distribution of ozone measurements within each month.

```{r}
plot <- ggplot(
  data = airquality,
  aes(x = Month, y = Ozone)) +
  geom_boxplot(fill = "grey70", na.rm = TRUE) + # Remove the NA values
  labs(title = "Ozone by Month",
       x = "Month",
       y = "Ozone (ppb)")
plot
```

We see that ozone peaks in the summer months July and August. It seems reasonable that this is due to more sunlight and also higher temperature.
```{r}
plot <- ggplot(
  data = airquality,
  aes(x = Month, y = Temp_C)) +
  geom_boxplot(fill = "grey70", na.rm = TRUE) + # Remove the NA values
  labs(title = "Temperature by Month") +
  labs(x = "Month") +
  labs(y = expression("Temperature (" ~ degree ~ "C)")) +
  theme_classic()
plot
```

As expected the temperatures by month boxplot looks very similar to the one before.
